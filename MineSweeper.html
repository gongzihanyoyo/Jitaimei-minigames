<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <!-- å­—ç¬¦ç¼–ç è®¾ç½® -->
    <meta charset="UTF-8">
    <!-- è§†å£é…ç½®ï¼šé€‚é…ç§»åŠ¨ç«¯ï¼Œç¦æ­¢ç¼©æ”¾ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç»å…¸æ‰«é›· | Jitaimeiå°æ¸¸æˆ minigames.jitaimei.top</title>
    <script>
        // è‡ªå®šä¹‰Tailwindä¸»é¢˜é…ç½®ï¼šæ‰©å±•æ‰«é›·ä¸“å±é¢œè‰²å’Œå­—ä½“
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        mine: {
                            bg: '#C0C0C0',      // æ¸¸æˆæ£‹ç›˜èƒŒæ™¯è‰²
                            cell: '#D0D0D0',    // æ ¼å­é»˜è®¤èƒŒæ™¯è‰²
                            border: '#7B7B7B #FFF #FFF #7B7B7B', // æ ¼å­è¾¹æ¡†è‰²
                            revealed: '#E0E0E0' // æ ¼å­æ­å¼€åèƒŒæ™¯è‰²
                        }
                    },
                    fontFamily: {
                        mine: ['system-ui', 'sans-serif'] // æ¸¸æˆé»˜è®¤å­—ä½“
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            /* æ‰«é›·åŸºç¡€æ ¼å­æ ·å¼ï¼šå¼¹æ€§å±…ä¸­ã€å‡¸èµ·è¾¹æ¡†ã€é¼ æ ‡æ ·å¼ã€ç¦æ­¢é€‰ä¸­æ–‡æœ¬ */
            .mine-cell {
                @apply flex items-center justify-center border-2 cursor-pointer select-none font-bold transition-all;
                border-style: outset; /* å‡¸èµ·è¾¹æ¡† */
                border-color: #ffffff #7b7b7b #7b7b7b #ffffff; /* å·¦ä¸Šç™½ã€å³ä¸‹ç°ï¼Œæ¨¡æ‹Ÿç«‹ä½“ */
                background-color: #d0d0d0;
            }
            /* å·²æ­å¼€çš„æ ¼å­æ ·å¼ï¼šæ‰å¹³è¾¹æ¡†ã€æµ…èƒŒæ™¯ */
            .mine-cell-revealed {
                @apply bg-mine-revealed border border-gray-400;
                border-style: solid; /* æ‰å¹³è¾¹æ¡†å–æ¶ˆå‡¸èµ· */
            }
            /* åœ°é›·æ ¼å­æ ·å¼ï¼šçº¢è‰²èƒŒæ™¯ã€ç™½è‰²æ–‡å­— */
            .mine-cell-mine {
                @apply bg-red-500 text-white;
            }
            /* æ¸¸æˆé€šç”¨æŒ‰é’®æ ·å¼ */
            .mine-btn {
                @apply px-3 py-1 bg-gray-700 text-white rounded hover:bg-gray-600 transition-colors;
            }
            /* æ¸¸æˆé¢æ¿ï¼ˆé›·æ•°/æ—¶é—´/é‡ç½®ï¼‰æ ·å¼ */
            .mine-panel {
                @apply bg-gray-800 text-white p-2 rounded flex justify-between items-center gap-2;
            }
            /* æ¸¸æˆæ£‹ç›˜å®¹å™¨ï¼šæ­£æ–¹å½¢ã€ç½‘æ ¼å¸ƒå±€ã€å›ºå®šæœ€å¤§å®½åº¦ï¼Œé€‚é…ç§»åŠ¨ç«¯ */
            .square-grid-board {
                aspect-ratio: 1 / 1 !important; /* å¼ºåˆ¶æ­£æ–¹å½¢ */
                display: grid !important;
                border: 4px solid #374151;
                background-color: #C0C0C0;
                width: calc(100vw - 20px) !important; /* å æ»¡è§†å£å®½åº¦ï¼Œç•™è¾¹è· */
                max-width: 600px; /* æ¡Œé¢ç«¯æœ€å¤§å®½åº¦é™åˆ¶ */
            }
        }
    </style>
</head>
<!-- é¡µé¢ä¸»ä½“ï¼šæ·±ç°èƒŒæ™¯ã€å¼¹æ€§å±…ä¸­ã€å æ»¡è§†å£é«˜åº¦ã€å†…å¤–è¾¹è· -->
<body class="bg-gray-900 font-mine min-h-screen flex flex-col items-center py-3 px-2 m-0">
    <!-- é¡¶éƒ¨æ“ä½œæ ï¼šè¿”å›ä¸»ç«™ + è®¾ç½®æŒ‰é’® -->
    <div class="w-full max-w-xl flex justify-between items-center mb-2">
        <button onclick="window.location.href='https://minigames.jitaimei.top'" class="mine-btn">
            â† è¿”å›ä¸»ç«™
        </button>
        <button onclick="openSettings()" class="mine-btn">
            âš™ï¸ è®¾ç½®
        </button>
    </div>
    <!-- æ¸¸æˆä¿¡æ¯é¢æ¿ï¼šå‰©ä½™é›·æ•°ã€è®¡æ—¶ã€é‡ç½®æ¸¸æˆ -->
    <div class="w-full max-w-xl mine-panel mb-3">
        <div>ğŸ’£ å‰©ä½™é›·æ•°: <span id="mineCount">30</span></div>
        <div>â±ï¸ æ—¶é—´: <span id="timer">0</span>s</div>
        <button onclick="initGame()" class="bg-yellow-600 hover:bg-yellow-500 px-2 py-1 rounded text-sm">
            ğŸ”„ é‡ç½®
        </button>
    </div>
    <!-- æ¸¸æˆæ£‹ç›˜å®¹å™¨ï¼šåŠ¨æ€ç”Ÿæˆæ ¼å­ -->
    <div id="gameBoard" class="square-grid-board"></div>
    <!-- è®¾ç½®å¼¹çª—ï¼šå›ºå®šå®šä½ã€åŠé€æ˜é®ç½©ã€å±…ä¸­æ˜¾ç¤ºï¼Œé»˜è®¤éšè— -->
    <div id="settingsModal" class="fixed inset-0 bg-black/70 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-5 w-full max-w-md">
            <h3 class="text-xl font-bold mb-4 text-center">æ¸¸æˆè®¾ç½®</h3>
            <!-- æ ¼å­å°ºå¯¸è®¾ç½®ï¼šè¡Œ+åˆ—ï¼Œ5Ã—5~30Ã—30 -->
            <div class="mb-3">
                <label class="block font-medium mb-1">æ ¼å­å°ºå¯¸ (5Ã—5 ~ 30Ã—30)</label>
                <div class="flex gap-2">
                    <input type="number" id="rows" min="5" max="30" value="10" class="w-1/2 p-2 border rounded">
                    <input type="number" id="cols" min="5" max="30" value="10" class="w-1/2 p-2 border rounded">
                </div>
            </div>
            <!-- åœ°é›·æ•°é‡è®¾ç½®ï¼š1~æœ€å¤§æ ¼å­æ•°-1 -->
            <div class="mb-3">
                <label class="block font-medium mb-1">åœ°é›·æ•°é‡ (1~æœ€å¤§æ ¼å­æ•°-1)</label>
                <input type="number" id="mines" min="1" max="899" value="30" class="w-full p-2 border rounded">
            </div>
            <!-- é¢„è®¾éš¾åº¦ï¼šç‚¹å‡»å¿«é€Ÿèµ‹å€¼è¡Œ/åˆ—/é›·æ•° -->
            <div class="mb-4">
                <label class="block font-medium mb-1">é¢„è®¾éš¾åº¦</label>
                <div class="flex gap-2 flex-wrap">
                    <button onclick="setDifficulty(5,5,3)" class="flex-1 bg-blue-600 text-white p-2 rounded">ç®€å•</button>
                    <button onclick="setDifficulty(10,10,15)" class="flex-1 bg-blue-600 text-white p-2 rounded">ä¸­ç­‰</button>
                    <button onclick="setDifficulty(16,16,40)" class="flex-1 bg-blue-600 text-white p-2 rounded">å›°éš¾</button>
                    <button onclick="setDifficulty(20,20,60)" class="flex-1 bg-blue-600 text-white p-2 rounded">ä¸“å®¶</button>
                </div>
            </div>
            <!-- è®¾ç½®å¼¹çª—æ“ä½œæŒ‰é’®ï¼šä¿å­˜/å–æ¶ˆ -->
            <div class="flex gap-2">
                <button onclick="saveSettings()" class="flex-1 bg-green-600 text-white p-2 rounded">ä¿å­˜è®¾ç½®</button>
                <button onclick="closeSettings()" class="flex-1 bg-gray-600 text-white p-2 rounded">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆå…¨å±€é…ç½®ï¼šå¯é€šè¿‡è®¾ç½®å¼¹çª—ä¿®æ”¹ï¼Œå®šä¹‰åŸºç¡€è§„åˆ™
        let config = {
            rows: 10,                // æ£‹ç›˜è¡Œæ•°
            cols: 10,                // æ£‹ç›˜åˆ—æ•°
            mines: 30,               // åœ°é›·æ•°é‡
            maxSize: 30,             // è¡Œåˆ—æœ€å¤§å°ºå¯¸
            minSize: 5,              // è¡Œåˆ—æœ€å°å°ºå¯¸
            longPressThreshold: 200  // ç§»åŠ¨ç«¯é•¿æŒ‰åˆ¤å®šé˜ˆå€¼ï¼ˆæ¯«ç§’ï¼‰
        };

        // æ¸¸æˆçŠ¶æ€ï¼šå®æ—¶è®°å½•æ¸¸æˆè¿è¡Œæ•°æ®ï¼Œåˆå§‹åŒ–æ—¶é‡ç½®
        let gameState = {
            board: [],               // æ£‹ç›˜æ•°ç»„ï¼šå­˜å‚¨æ¯ä¸ªæ ¼å­çš„ç›¸é‚»åœ°é›·æ•°ï¼Œ-1=å·²æ­å¼€ï¼Œ-2=å·²æ ‡è®°
            mineMap: [],             // åœ°é›·åœ°å›¾ï¼šäºŒç»´å¸ƒå°”æ•°ç»„ï¼Œtrue=è¯¥ä½ç½®æ˜¯åœ°é›·
            revealed: 0,             // å·²æ­å¼€çš„æ ¼å­æ•°é‡
            flagged: 0,              // å·²æ ‡è®°ï¼ˆæ’æ——ï¼‰çš„æ ¼å­æ•°é‡
            gameOver: false,         // æ¸¸æˆæ˜¯å¦ç»“æŸï¼ˆèƒœåˆ©/å¤±è´¥ï¼‰
            timer: null,             // è®¡æ—¶å®šæ—¶å™¨
            startTime: 0,            // è®¡æ—¶å¼€å§‹æ—¶é—´æˆ³
            touchTimer: null,        // ç§»åŠ¨ç«¯è§¦æ‘¸å®šæ—¶å™¨ï¼ˆç”¨äºé•¿æŒ‰åˆ¤å®šï¼‰
            isLongPressTriggered: false, // æ˜¯å¦è§¦å‘äº†é•¿æŒ‰äº‹ä»¶
            touchStartX: 0,          // ç§»åŠ¨ç«¯è§¦æ‘¸èµ·å§‹Xåæ ‡ï¼ˆé˜²è¯¯è§¦ï¼‰
            touchStartY: 0           // ç§»åŠ¨ç«¯è§¦æ‘¸èµ·å§‹Yåæ ‡ï¼ˆé˜²è¯¯è§¦ï¼‰
        };

        // è·å–é¡µé¢æ ¸å¿ƒDOMå…ƒç´ ï¼Œæ–¹ä¾¿åç»­æ“ä½œ
        const gameBoard = document.getElementById('gameBoard');   // æ¸¸æˆæ£‹ç›˜å®¹å™¨
        const mineCountEl = document.getElementById('mineCount'); // å‰©ä½™é›·æ•°æ˜¾ç¤ºå…ƒç´ 
        const timerEl = document.getElementById('timer');         // è®¡æ—¶æ˜¾ç¤ºå…ƒç´ 
        const settingsModal = document.getElementById('settingsModal'); // è®¾ç½®å¼¹çª—

        /**
         * åˆå§‹åŒ–æ¸¸æˆæ ¸å¿ƒæ–¹æ³•
         * æ¸…é™¤å®šæ—¶å™¨ã€é‡ç½®æ¸¸æˆçŠ¶æ€ã€æ›´æ–°DOMæ˜¾ç¤ºã€é‡æ–°ç”Ÿæˆæ£‹ç›˜/åœ°é›·/æ¸²æŸ“
         */
        function initGame() {
            // æ¸…é™¤æ‰€æœ‰å®šæ—¶å™¨ï¼Œé˜²æ­¢å¤šæ¬¡è§¦å‘
            clearInterval(gameState.timer);
            clearTimeout(gameState.touchTimer);
            // é‡ç½®æ¸¸æˆçŠ¶æ€ä¸ºåˆå§‹å€¼
            gameState = {
                board: [],
                mineMap: [],
                revealed: 0,
                flagged: 0,
                gameOver: false,
                timer: null,
                startTime: 0,
                touchTimer: null,
                isLongPressTriggered: false,
                touchStartX: 0,
                touchStartY: 0
            };
            // é‡ç½®DOMæ˜¾ç¤ºçš„æ—¶é—´å’Œé›·æ•°
            timerEl.textContent = '0';
            mineCountEl.textContent = config.mines;
            // æ¸…ç©ºæ£‹ç›˜å®¹å™¨ï¼Œé‡æ–°ç”Ÿæˆ
            gameBoard.innerHTML = '';
            // é™åˆ¶åœ°é›·æ•°ï¼šä¸èƒ½è¶…è¿‡æ€»æ ¼å­æ•°-1ï¼Œä¸èƒ½å°äº1
            const maxMines = config.rows * config.cols - 1;
            config.mines = Math.max(1, Math.min(config.mines, maxMines));
            // æ‰§è¡Œæ¸¸æˆåˆå§‹åŒ–æµç¨‹
            createBoard();          // åˆ›å»ºç©ºæ£‹ç›˜æ•°ç»„
            placeMines();           // éšæœºæ”¾ç½®åœ°é›·
            calculateAdjacentMines(); // è®¡ç®—æ¯ä¸ªæ ¼å­çš„ç›¸é‚»åœ°é›·æ•°
            renderBoard();          // æ¸²æŸ“æ£‹ç›˜åˆ°é¡µé¢
        }

        /**
         * åˆ›å»ºç©ºæ£‹ç›˜æ•°ç»„
         * åˆå§‹åŒ–boardå’ŒmineMapä¸ºäºŒç»´æ•°ç»„ï¼Œé»˜è®¤å€¼ï¼šboard=0ï¼ŒmineMap=false
         */
        function createBoard() {
            for (let y = 0; y < config.rows; y++) {
                gameState.board[y] = [];
                gameState.mineMap[y] = [];
                for (let x = 0; x < config.cols; x++) {
                    gameState.board[y][x] = 0;    // åˆå§‹ç›¸é‚»åœ°é›·æ•°ä¸º0
                    gameState.mineMap[y][x] = false; // åˆå§‹æ— åœ°é›·
                }
            }
        }

        /**
         * éšæœºæ”¾ç½®åœ°é›·
         * å¾ªç¯ç”Ÿæˆéšæœºåæ ‡ï¼Œé¿å…é‡å¤æ”¾ç½®ï¼Œç›´åˆ°æ”¾å¤Ÿconfig.minesä¸ª
         */
        function placeMines() {
            let minesPlaced = 0; // å·²æ”¾ç½®åœ°é›·æ•°
            while (minesPlaced < config.mines) {
                // ç”Ÿæˆ0~rows-1/cols-1çš„éšæœºåæ ‡
                const y = Math.floor(Math.random() * config.rows);
                const x = Math.floor(Math.random() * config.cols);
                // è¯¥ä½ç½®æ— åœ°é›·æ—¶ï¼Œæ ‡è®°ä¸ºåœ°é›·å¹¶è®¡æ•°+1
                if (!gameState.mineMap[y][x]) {
                    gameState.mineMap[y][x] = true;
                    minesPlaced++;
                }
            }
        }

        /**
         * è®¡ç®—æ¯ä¸ªæ ¼å­çš„ç›¸é‚»åœ°é›·æ•°
         * å®šä¹‰8ä¸ªæ–¹å‘ï¼ˆä¸Šä¸‹å·¦å³+æ–œè§’ï¼‰ï¼Œéå†æ¯ä¸ªéåœ°é›·æ ¼å­ï¼Œç»Ÿè®¡å‘¨å›´åœ°é›·æ•°
         */
        function calculateAdjacentMines() {
            // 8ä¸ªç›¸é‚»æ–¹å‘çš„åæ ‡åç§»é‡
            const directions = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
            for (let y = 0; y < config.rows; y++) {
                for (let x = 0; x < config.cols; x++) {
                    if (gameState.mineMap[y][x]) continue; // åœ°é›·æ ¼å­è·³è¿‡ï¼Œæ— éœ€è®¡ç®—
                    let count = 0; // ç›¸é‚»åœ°é›·æ•°
                    // éå†8ä¸ªæ–¹å‘ï¼Œç»Ÿè®¡æœ‰æ•ˆèŒƒå›´å†…çš„åœ°é›·æ•°
                    for (let [dy, dx] of directions) {
                        const ny = y + dy, nx = x + dx;
                        // åæ ‡åœ¨æ£‹ç›˜å†…ï¼Œä¸”è¯¥ä½ç½®æ˜¯åœ°é›·ï¼Œè®¡æ•°+1
                        if (ny >=0 && ny < config.rows && nx >=0 && nx < config.cols && gameState.mineMap[ny][nx]) count++;
                    }
                    gameState.board[y][x] = count; // èµ‹å€¼ç›¸é‚»åœ°é›·æ•°
                }
            }
        }

        /**
         * æ¸²æŸ“æ£‹ç›˜åˆ°é¡µé¢
         * è®¾ç½®ç½‘æ ¼å¸ƒå±€ï¼Œå¾ªç¯åˆ›å»ºæ ¼å­DOMå…ƒç´ ï¼Œç»‘å®šç‚¹å‡»/å³é”®/ç§»åŠ¨ç«¯è§¦æ‘¸äº‹ä»¶
         */
        function renderBoard() {
            gameBoard.innerHTML = '';
            // è®¾ç½®CSSç½‘æ ¼å¸ƒå±€ï¼šåˆ—æ•°/è¡Œæ•°ç­‰äºé…ç½®çš„cols/rows
            gameBoard.style.gridTemplateColumns = `repeat(${config.cols}, 1fr)`;
            gameBoard.style.gridTemplateRows = `repeat(${config.rows}, 1fr)`;
            // éå†æ¯ä¸ªæ ¼å­åæ ‡ï¼Œåˆ›å»ºDOMå…ƒç´ 
            for (let y = 0; y < config.rows; y++) {
                for (let x = 0; x < config.cols; x++) {
                    const cell = document.createElement('div');
                    cell.className = 'mine-cell'; // åŸºç¡€æ ¼å­æ ·å¼
                    cell.dataset.y = y; // è‡ªå®šä¹‰å±æ€§ï¼šå­˜å‚¨è¡Œåæ ‡ï¼Œæ–¹ä¾¿äº‹ä»¶è·å–
                    cell.dataset.x = x; // è‡ªå®šä¹‰å±æ€§ï¼šå­˜å‚¨åˆ—åæ ‡ï¼Œæ–¹ä¾¿äº‹ä»¶è·å–
                    // é¼ æ ‡å·¦é”®ç‚¹å‡»ï¼šæ­å¼€æ ¼å­
                    cell.addEventListener('click', () => revealCell(y, x));
                    // é¼ æ ‡å³é”®ï¼šæ ‡è®°/å–æ¶ˆæ ‡è®°æ ¼å­ï¼ˆé˜»æ­¢é»˜è®¤å³é”®èœå•ï¼‰
                    cell.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        flagCell(y, x);
                    });
                    // ç§»åŠ¨ç«¯è§¦æ‘¸å¼€å§‹ï¼šè®°å½•èµ·å§‹åæ ‡ï¼Œå¯åŠ¨é•¿æŒ‰å®šæ—¶å™¨
                    cell.addEventListener('touchstart', (e) => {
                        gameState.touchStartX = e.touches[0].clientX;
                        gameState.touchStartY = e.touches[0].clientY;
                        gameState.isLongPressTriggered = false;
                        // è¾¾åˆ°é•¿æŒ‰é˜ˆå€¼åˆ™è§¦å‘æ ‡è®°æ ¼å­
                        gameState.touchTimer = setTimeout(() => {
                            gameState.isLongPressTriggered = true;
                            flagCell(y, x);
                        }, config.longPressThreshold);
                    });
                    // ç§»åŠ¨ç«¯è§¦æ‘¸ç»“æŸï¼šåˆ¤æ–­æ˜¯çŸ­æŒ‰ï¼ˆæ­å¼€ï¼‰è¿˜æ˜¯é•¿æŒ‰ï¼ˆå·²æ ‡è®°ï¼‰ï¼Œé˜²è¯¯è§¦
                    cell.addEventListener('touchend', (e) => {
                        clearTimeout(gameState.touchTimer); // æ¸…é™¤é•¿æŒ‰å®šæ—¶å™¨
                        // è·å–è§¦æ‘¸ç»“æŸåæ ‡ï¼Œè®¡ç®—åç§»é‡
                        const touchEndX = e.changedTouches[0].clientX;
                        const touchEndY = e.changedTouches[0].clientY;
                        const dx = Math.abs(touchEndX - gameState.touchStartX);
                        const dy = Math.abs(touchEndY - gameState.touchStartY);
                        // åç§»é‡<10ï¼ˆé˜²æ»‘åŠ¨è¯¯è§¦ï¼‰ä¸”æœªè§¦å‘é•¿æŒ‰ â†’ çŸ­æŒ‰æ­å¼€æ ¼å­
                        if (dx < 10 && dy < 10 && !gameState.isLongPressTriggered) {
                            revealCell(y, x);
                        }
                    });
                    // ç§»åŠ¨ç«¯è§¦æ‘¸ç§»åŠ¨ï¼šæ¸…é™¤å®šæ—¶å™¨ï¼Œå–æ¶ˆé•¿æŒ‰/çŸ­æŒ‰ï¼ˆé˜²æ»‘åŠ¨è¯¯è§¦ï¼‰
                    cell.addEventListener('touchmove', () => {
                        clearTimeout(gameState.touchTimer);
                        gameState.isLongPressTriggered = false;
                    });
                    // ç§»åŠ¨ç«¯è§¦æ‘¸å–æ¶ˆï¼šæ¸…é™¤å®šæ—¶å™¨ï¼Œå–æ¶ˆé•¿æŒ‰/çŸ­æŒ‰
                    cell.addEventListener('touchcancel', () => {
                        clearTimeout(gameState.touchTimer);
                        gameState.isLongPressTriggered = false;
                    });
                    gameBoard.appendChild(cell); // å°†æ ¼å­æ·»åŠ åˆ°æ£‹ç›˜å®¹å™¨
                }
            }
        }

        /**
         * æ­å¼€æ ¼å­æ ¸å¿ƒæ–¹æ³•
         * å‰ç½®åˆ¤æ–­æ¸¸æˆçŠ¶æ€ï¼Œé¦–æ¬¡æ­å¼€å¯åŠ¨è®¡æ—¶ï¼Œè¸©åˆ°åœ°é›·åˆ™æ¸¸æˆå¤±è´¥ï¼Œå¦åˆ™é€’å½’æ­å¼€
         * @param {number} y - æ ¼å­è¡Œåæ ‡
         * @param {number} x - æ ¼å­åˆ—åæ ‡
         */
        function revealCell(y, x) {
            // æ¸¸æˆç»“æŸ/æ ¼å­å·²æ­å¼€/æ ¼å­å·²æ ‡è®° â†’ ç›´æ¥è¿”å›ï¼Œä¸æ‰§è¡Œæ“ä½œ
            if (gameState.gameOver || gameState.board[y][x] === -1 || gameState.board[y][x] === -2) return;
            // é¦–æ¬¡æ­å¼€æ ¼å­ â†’ å¯åŠ¨è®¡æ—¶ï¼ˆé¿å…æœªå¼€å§‹æ¸¸æˆå°±è®¡æ—¶ï¼‰
            if (gameState.revealed === 0) startTimer();
            // è¸©åˆ°åœ°é›· â†’ æ¸¸æˆå¤±è´¥
            if (gameState.mineMap[y][x]) { gameOver(false); return; }
            // éåœ°é›· â†’ é€’å½’æ­å¼€å½“å‰åŠå‘¨å›´æ ¼å­
            revealRecursive(y, x);
            // æ£€æŸ¥æ˜¯å¦æ»¡è¶³èƒœåˆ©æ¡ä»¶
            checkWin();
        }

        /**
         * é€’å½’æ­å¼€æ ¼å­
         * å¤„ç†è¾¹ç•Œåˆ¤æ–­ï¼Œå·²æ­å¼€/å·²æ ‡è®°æ ¼å­è·³è¿‡ï¼Œ0åœ°é›·æ ¼å­é€’å½’æ­å¼€å‘¨å›´8ä¸ªæ–¹å‘
         * @param {number} y - æ ¼å­è¡Œåæ ‡
         * @param {number} x - æ ¼å­åˆ—åæ ‡
         */
        function revealRecursive(y, x) {
            const directions = [[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
            // åæ ‡è¶Šç•Œ/æ ¼å­å·²æ­å¼€/æ ¼å­å·²æ ‡è®° â†’ ç›´æ¥è¿”å›
            if (y <0 || y >= config.rows || x <0 || x >= config.cols || gameState.board[y][x] === -1 || gameState.board[y][x] === -2) return;
            gameState.revealed++; // å·²æ­å¼€æ ¼å­æ•°+1
            const cellVal = gameState.board[y][x]; // è·å–å½“å‰æ ¼å­çš„ç›¸é‚»åœ°é›·æ•°
            gameState.board[y][x] = -1; // æ ‡è®°æ ¼å­ä¸ºã€Œå·²æ­å¼€ã€çŠ¶æ€
            // è·å–å½“å‰æ ¼å­DOMå…ƒç´ ï¼Œä¿®æ”¹æ ·å¼
            const cell = document.querySelector(`[data-y="${y}"][data-x="${x}"]`);
            cell.classList.add('mine-cell-revealed'); // æ·»åŠ å·²æ­å¼€æ ·å¼
            // ç›¸é‚»åœ°é›·æ•°>0 â†’ æ˜¾ç¤ºæ•°å­—ï¼Œå¹¶è®¾ç½®å¯¹åº”é¢œè‰²
            if (cellVal > 0) {
                cell.textContent = cellVal;
                // åœ°é›·æ•°å¯¹åº”é¢œè‰²ï¼š1è“~8ç°ï¼Œç¬¦åˆç»å…¸æ‰«é›·è®¾è®¡
                const colors = ['blue', 'green', 'red', 'darkblue', 'brown', 'cyan', 'black', 'gray'];
                cell.style.color = colors[cellVal - 1];
            }
            // ç›¸é‚»åœ°é›·æ•°=0 â†’ é€’å½’æ­å¼€å‘¨å›´8ä¸ªæ–¹å‘çš„æ ¼å­
            if (cellVal === 0) {
                for (let [dy, dx] of directions) revealRecursive(y+dy, x+dx);
            }
        }

        /**
         * æ ‡è®°/å–æ¶ˆæ ‡è®°æ ¼å­ï¼ˆæ’æ——ï¼‰
         * æ¸¸æˆç»“æŸ/æ ¼å­å·²æ­å¼€ â†’ ç¦æ­¢æ“ä½œï¼Œåˆ‡æ¢æ ¼å­æ ‡è®°çŠ¶æ€å¹¶æ›´æ–°DOM
         * @param {number} y - æ ¼å­è¡Œåæ ‡
         * @param {number} x - æ ¼å­åˆ—åæ ‡
         */
        function flagCell(y, x) {
            // æ¸¸æˆç»“æŸ/æ ¼å­å·²æ­å¼€ â†’ ç›´æ¥è¿”å›
            if (gameState.gameOver || gameState.board[y][x] === -1) return;
            // é¦–æ¬¡æ ‡è®° â†’ å¯åŠ¨è®¡æ—¶
            if (gameState.revealed === 0) startTimer();
            const cell = document.querySelector(`[data-y="${y}"][data-x="${x}"]`);
            // å·²æ ‡è®°ï¼ˆ-2ï¼‰â†’ å–æ¶ˆæ ‡è®°ï¼Œæ¢å¤ä¸º0ï¼Œç§»é™¤æ——å­
            if (gameState.board[y][x] === -2) {
                gameState.board[y][x] = 0;
                gameState.flagged--;
                cell.textContent = '';
            } else {
                // æœªæ ‡è®° â†’ æ ‡è®°ä¸º-2ï¼Œæ·»åŠ æ——å­ï¼Œæ ‡è®°æ•°+1
                gameState.board[y][x] = -2;
                gameState.flagged++;
                cell.textContent = 'ğŸš©';
            }
            // æ›´æ–°å‰©ä½™é›·æ•°ï¼šæ€»é›·æ•° - å·²æ ‡è®°æ•°
            mineCountEl.textContent = config.mines - gameState.flagged;
        }

        /**
         * æ¸¸æˆç»“æŸå¤„ç†
         * åœæ­¢è®¡æ—¶ï¼Œå¤±è´¥åˆ™æ˜¾ç¤ºæ‰€æœ‰åœ°é›·ï¼Œå¼¹å‡ºå¯¹åº”æç¤º
         * @param {boolean} isWin - æ˜¯å¦èƒœåˆ©ï¼Œtrue=èƒœåˆ©ï¼Œfalse=å¤±è´¥
         */
        function gameOver(isWin) {
            gameState.gameOver = true; // æ ‡è®°æ¸¸æˆç»“æŸ
            clearInterval(gameState.timer); // åœæ­¢è®¡æ—¶
            // æ¸¸æˆå¤±è´¥ â†’ éå†æ£‹ç›˜ï¼Œæ˜¾ç¤ºæ‰€æœ‰åœ°é›·æ ¼å­æ ·å¼å’Œå›¾æ ‡
            if (!isWin) {
                for (let y = 0; y < config.rows; y++) {
                    for (let x = 0; x < config.cols; x++) {
                        if (gameState.mineMap[y][x]) {
                            const cell = document.querySelector(`[data-y="${y}"][data-x="${x}"]`);
                            cell.classList.add('mine-cell-revealed', 'mine-cell-mine');
                            cell.textContent = 'ğŸ’£';
                        }
                    }
                }
                alert('æ¸¸æˆç»“æŸï¼è¸©åˆ°é›·äº†ï¼');
            }
        }

        /**
         * æ£€æŸ¥èƒœåˆ©æ¡ä»¶
         * å·²æ­å¼€æ ¼å­æ•° = æ€»æ ¼å­æ•° - åœ°é›·æ•° â†’ æ¸¸æˆèƒœåˆ©ï¼Œè°ƒç”¨gameOverå¹¶å¼¹å‡ºæç¤º
         */
        function checkWin() {
            if (gameState.revealed === config.rows * config.cols - config.mines) {
                gameOver(true); // ä¼ å…¥trueè¡¨ç¤ºèƒœåˆ©
                alert('æ­å–œä½ ï¼æ‰«é›·æˆåŠŸï¼');
            }
        }

        /**
         * å¯åŠ¨æ¸¸æˆè®¡æ—¶
         * è®°å½•å¼€å§‹æ—¶é—´æˆ³ï¼Œå¼€å¯å®šæ—¶å™¨ï¼Œæ¯ç§’æ›´æ–°æ—¶é—´æ˜¾ç¤º
         */
        function startTimer() {
            gameState.startTime = Date.now(); // è®°å½•æ¯«ç§’çº§æ—¶é—´æˆ³
            gameState.timer = setInterval(() => {
                // è®¡ç®—å·²æµé€æ—¶é—´ï¼šç§’çº§ï¼Œå‘ä¸‹å–æ•´
                timerEl.textContent = Math.floor((Date.now() - gameState.startTime)/1000);
            }, 1000); // æ¯ç§’æ‰§è¡Œä¸€æ¬¡
        }

        /**
         * æ‰“å¼€è®¾ç½®å¼¹çª—
         * å°†å½“å‰æ¸¸æˆé…ç½®èµ‹å€¼åˆ°è¾“å…¥æ¡†ï¼Œæ˜¾ç¤ºå¼¹çª—
         */
        function openSettings() {
            document.getElementById('rows').value = config.rows;
            document.getElementById('cols').value = config.cols;
            document.getElementById('mines').value = config.mines;
            settingsModal.classList.remove('hidden'); // æ˜¾ç¤ºå¼¹çª—
        }

        /**
         * å…³é—­è®¾ç½®å¼¹çª—
         * éšè—å¼¹çª—ï¼Œä¸ä¿å­˜ä»»ä½•ä¿®æ”¹
         */
        function closeSettings() { settingsModal.classList.add('hidden'); }

        /**
         * è®¾ç½®é¢„è®¾éš¾åº¦
         * ç»™è®¾ç½®å¼¹çª—çš„è¾“å…¥æ¡†èµ‹å€¼å¯¹åº”è¡Œ/åˆ—/é›·æ•°
         * @param {number} rows - è¡Œæ•°
         * @param {number} cols - åˆ—æ•°
         * @param {number} mines - åœ°é›·æ•°
         */
        function setDifficulty(rows, cols, mines) {
            document.getElementById('rows').value = rows;
            document.getElementById('cols').value = cols;
            document.getElementById('mines').value = mines;
        }

        /**
         * ä¿å­˜æ¸¸æˆè®¾ç½®
         * è·å–è¾“å…¥æ¡†å€¼ï¼ŒéªŒè¯åˆæ³•æ€§ï¼Œæ›´æ–°é…ç½®ï¼Œå…³é—­å¼¹çª—å¹¶é‡æ–°åˆå§‹åŒ–æ¸¸æˆ
         */
        function saveSettings() {
            // è·å–è¾“å…¥æ¡†çš„æ•°å€¼å¹¶è½¬ä¸ºæ•´æ•°
            const rows = parseInt(document.getElementById('rows').value);
            const cols = parseInt(document.getElementById('cols').value);
            const mines = parseInt(document.getElementById('mines').value);
            
            // éªŒè¯å°ºå¯¸åˆæ³•æ€§ï¼šå¿…é¡»åœ¨5~30ä¹‹é—´
            if (rows < config.minSize || rows > config.maxSize || cols < config.minSize || cols > config.maxSize) {
                alert(`å°ºå¯¸å¿…é¡»åœ¨${config.minSize}Ã—${config.minSize}~${config.maxSize}Ã—${config.maxSize}`);
                return;
            }
            // éªŒè¯åœ°é›·æ•°åˆæ³•æ€§ï¼š1~æ€»æ ¼å­æ•°-1
            const maxMines = rows * cols - 1;
            if (mines < 1 || mines > maxMines) {
                alert(`é›·æ•°å¿…é¡»åœ¨1~${maxMines}ä¹‹é—´`);
                return;
            }
            // éªŒè¯é€šè¿‡ï¼Œæ›´æ–°å…¨å±€é…ç½®
            config.rows = rows; 
            config.cols = cols; 
            config.mines = mines;
            // å…³é—­å¼¹çª—å¹¶é‡æ–°åˆå§‹åŒ–æ¸¸æˆ
            closeSettings(); 
            initGame();
        }

        // çª—å£å¤§å°æ”¹å˜æ—¶ï¼Œé‡æ–°æ¸²æŸ“æ£‹ç›˜ï¼ˆé€‚é…ç§»åŠ¨ç«¯å±å¹•ç¼©æ”¾ï¼‰
        window.addEventListener('resize', () => renderBoard());
        // ç§»åŠ¨ç«¯å±å¹•æ—‹è½¬æ—¶ï¼Œé‡æ–°æ¸²æŸ“æ£‹ç›˜ï¼ˆé€‚é…æ¨ªç«–å±åˆ‡æ¢ï¼‰
        window.addEventListener('orientationchange', () => renderBoard());
        // é¡µé¢åŠ è½½å®Œæˆåï¼Œåˆå§‹åŒ–æ¸¸æˆï¼ˆå…¥å£ï¼‰
        window.addEventListener('load', initGame);
    </script>
</body>
</html>
